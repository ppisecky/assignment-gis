from locust import HttpLocust, TaskSet, task
import random

regionLevelBounds = {
    'regions': [
        [6.318022499380476, 43.60354059368498,
            17.435584653856807, 47.168328442902606],
        [6.103544568583743, 44.100856054842694,
            17.221106723059535, 47.635109844622576],
        [8.448655335732411, 43.339226087841126,
            19.56621749020715, 46.92014289163933]
    ],

    'provinces': [
        [9.257222774251659,44.893852893744764,14.530660274258281,46.57493990552919],
        [9.018100465966,45.74168135336603,14.291537965973475,47.39744826409475],
        [8.24905749759705,44.00173612094241,13.522494997604525,45.709085830033615]
    ],

    'municipalities': [
        [11.1079060696907,46.54187253997131,11.767085757185072,46.74857739840573],
        [11.413806643476164,46.384134840720236,12.072986330970451,46.59144049482063],
        [11.160434451505182,46.01676618888132,11.819614138999498,46.225465022717486],
        [11.178973880210833,45.68652814782436,11.838153567705206,45.896472070455246],
        [11.744426456347156,45.41557579509373,12.403606143841557,45.626536105513395],
        [11.495144831862149,45.05239419482123,12.154324519356464,45.26470949791923],
        [10.644047726832554,44.16786300228878,11.303227414326756,44.383442800776265],
        [9.87879000557507,44.48968248860993,10.537969693069414,44.70408043655863]
    ]
}

detailLevelBounds = [
    [10.16752444161716,44.51680089822145,10.497114285377506,44.62404880694339], [10.50256499290083,44.31568309672812,10.832154836661118,44.4233008593705],
    [10.689160909274591,44.139535585641426,11.018750753034908,44.2474761959449], [11.341131246746471,44.12262443223446,11.670721090506731,44.230595984252744],
    [10.896527852575417,44.06261368175234,11.226117696335734,44.17069495750869], [11.164835012743225,44.15933477482989,11.494424856503542,44.267239147369395],
    [11.677987000070544,44.03177384098041,12.007576843830861,44.13991145835493], [12.008504006048696,43.896676249413645,12.338093849808985,44.00506030951669],
    [12.064321934860459,45.44497220889957,12.393911778620748,45.55049621567366], [12.204397618379488,45.38279270057305,12.533987462139777,45.48843306203571],
    [12.314127529130502,45.52147808762322,12.643717372890734,45.62685876115506], [12.344496914693849,45.62181653248879,12.674086758454195,45.7270089386661],
    [12.339198707525327,45.77206633100468,12.668788551285644,45.87697621864169], [12.3153377756866,45.944578204621166,12.644927619446833,46.049162826701235],
    [12.095898398758976,46.08359882192937,12.425488242519236,46.187920637064366], [11.826188162597646,46.22977055165231,12.155778006357963,46.33381538079465],
    [11.725050262765194,46.41029603932557,12.054640106525426,46.513997852567684], [11.671598024835248,46.66668004048964,12.001187868595565,46.76989293591535],
    [11.3978679390693,46.66943115962661,11.727457782829646,46.77263879754511], [10.983820583642654,46.613518265603375,11.313410427403,46.7168327088649],
    [10.758982089689596,46.606203236394464,11.088571933449884,46.70953164563946], [10.372349043180634,46.598839796193516,10.70193888694098,46.70218226215303],
    [10.401885794704299,46.324643329429676,10.731475638464616,46.42850801930322], [10.520478711569751,46.000090964306395,10.850068555330154,46.104570717667286],
    [10.426483663058832,45.75563774068553,10.675887118961924,45.83506555143296], [10.590607547362112,45.56562217529745,10.840011003265147,45.64532018763404],
    [10.710639158758596,45.46592831860326,10.96004261466166,45.545767745659674], [10.502915040441252,45.33813806268793,10.752318496344373,45.4181584061113],
    [10.743649502242903,45.27251631398832,10.993052958146023,45.352629405718915], [11.066884783106758,45.22675648705396,11.316288239009822,45.30693419264546]
]

tourismTypes = [ "alpine_hut", "apartment", "attraction", "bed_and_breakfast", "camp_site", "caravan_site", "gallery", "guest_house", "hostel", "hotel", "chalet", "information", "motel", "museum", "picnic_site", "theme_park", "viewpoint", "wilderness_hut", "zoo" ]


def encodeBounds(bb):
    return 'bounds[]=' + '&bounds[]='.join([str(n) for n in bb])


class APIClientBehavior(TaskSet):

    @task(1)
    def regionsOverview(self):
        bb = random.choice(regionLevelBounds['regions'])
        self.client.get('/areas/summaries?type=regions&' + encodeBounds(bb))

    @task(2)
    def provincesOverview(self):
        bb = random.choice(regionLevelBounds['provinces'])
        self.client.get('/areas/summaries?type=provinces&' + encodeBounds(bb))

    @task(3)
    def municipalitiesOverview(self):
        bb = random.choice(regionLevelBounds['municipalities'])
        self.client.get('/areas/summaries?type=municipalities&' + encodeBounds(bb))

    @task(4)
    def touristPlaces(self):
        bb = random.choice(detailLevelBounds)
        q = '/places/tourist?' + encodeBounds(bb)
        if bool(random.getrandbits(1)):
            tourism = random.sample(tourismTypes, random.randint(0, len(tourismTypes)))
            q += '&tourism[]=' + '&tourism[]='.join(tourism)
        self.client.get(q)

    @task(5)
    def squares(self):
        bb = random.choice(detailLevelBounds)
        self.client.get('/areas/squares?' + encodeBounds(bb))

class WebsiteUser(HttpLocust):
    task_set = APIClientBehavior
    min_wait = 3000
    max_wait = 10000
